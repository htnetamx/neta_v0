@model ProductDetailsModel
@if (!string.IsNullOrWhiteSpace(Model.StockAvailability) || Model.DisplayBackInStockSubscription)
{
<div class="availability">
    <div class="stock">
        <span class="value">@Model.CurrentStoreName</span>
    </div>
    @if (Model.AvailableEndDate.HasValue)
    {
        <div id="counterCtrl">
            <div class="stock">
                <span class="value" id="stock-availabilityenddate-value-@Model.Id"></span>
            </div>
            <div class="stock">
                <span class="label" style="font-weight: bold">@Model.CurrentStockQuantity productos comprados</span>
            </div>
            <progress max="@Model.StockQuantity" value="80" style="width: 100%; height: 25px"></progress>
            <div class="stock">
                <span class="label" style="font-weight: bold">Faltan @Model.StockQuantity productos para conseguir el descuento de grupo</span>
            </div>
        </div>
        <div id="legendCtrl">
            <div class="stock" style="padding-top: 10px">
                <span class="label">@T("Products.Availability"):</span>
                <span class="value" id="stock-availability-value-@Model.Id">Sin Stock</span>
            </div>
        </div>

        <script asp-location="Footer">
    function counter() {
        var current_date = new Date().getTime();
        var future_date = new Date(@Model.AvailableEndDate.Value.Year,
                                    @Model.AvailableEndDate.Value.Month-1,
                                    @Model.AvailableEndDate.Value.Day,
                                    @Model.AvailableEndDate.Value.Hour,
                                    @Model.AvailableEndDate.Value.Minute,
                                    @Model.AvailableEndDate.Value.Second).getTime();

        var seconds_left = (future_date - current_date) / 1000;

        days = parseInt(seconds_left / 86400);
        seconds_left = seconds_left % 86400;
        console.log(days, seconds_left)

        hours = parseInt(seconds_left / 3600);
        seconds_left = seconds_left % 3600;

        minutes = parseInt(seconds_left / 60);
        seconds = parseInt(seconds_left % 60);

        if (seconds <= 0) {
            $("#counterCtrl").hide();
            $("#legendCtrl").show();
        } else {
            $("#counterCtrl").show();
            $("#legendCtrl").hide();
        }

        var countdown = days + "d, " + hours + "h, " + minutes + "m, " + seconds + "s";
        $("#stock-availabilityenddate-value-@Model.Id").text(countdown + " faltan para el cierre de la compra");
    }
    $(document).ready(function () {
        $("#counterCtrl").hide();
        $("#legendCtrl").hide();

        counter();
        window.setInterval(function () {
            counter();
        }, 1000);
    });
        </script>
    }
    else
    {
        <div class="stock" style="padding-top: 10px">
            <span class="label">@T("Products.Availability"):</span>
            <span class="value" id="stock-availability-value-@Model.Id">@Model.StockAvailability</span>
        </div>
    }
    @await Html.PartialAsync("_BackInStockSubscription", Model)

</div>
}